(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9772],{94388:function(e,a,t){Promise.resolve().then(t.bind(t,78577))},78577:function(e,a,t){"use strict";t.r(a),t.d(a,{default:function(){return F}});var s=t(57437),r=t(2265),i=t(93191),n=t(65118),l=t(57883),d=t(64308),c=t(6807),o=t(84593),u=t(20357),x=t(19302),m=t(35231),h=t(92566),y=t(54142),p=t(2842),g=t(9542),v=t(85475),f=t(16638),b=t(23909),j=t(85369),N=t(68295),w=t(27561),q=t(86991);async function _(e,a){let t=await fetch(e,{...a,cache:"no-store"});if(!t.ok)throw Error("Request failed: ".concat(t.status));return t.json()}function k(e,a){(0,r.useEffect)(()=>{let t=function(){let e=u.env.NEXT_PUBLIC_SUPABASE_URL||u.env.SUPABASE_URL,a=u.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||u.env.SUPABASE_ANON_KEY;if(!e||!a)throw Error("Supabase env missing");return(0,o.eI)(e,a)}(),s=t.channel("rt:".concat(e)).on("postgres_changes",{event:"*",schema:"public",table:e},()=>{a()}).subscribe();return()=>{t.removeChannel(s)}},[e,a])}async function K(){return _("/api/admin/metrics/top")}async function L(e){let a=new URLSearchParams({range:e});return _("/api/admin/metrics/user-growth?".concat(a.toString()))}async function S(){return _("/api/admin/metrics/lead-quality")}async function E(){return _("/api/admin/metrics/revenue-forecast")}async function R(){return _("/api/admin/metrics/funnel")}async function A(){return _("/api/admin/metrics/top-properties")}async function C(){return _("/api/admin/metrics/builder-leaderboard")}async function U(){return _("/api/admin/metrics/recent-activity")}function F(){var e,a,t,o,u,_,F,B,M,Q,W;let z=(0,i.NL)(),[V,Y]=(0,r.useState)("30d"),G=(0,n.a)({queryKey:["admin-top"],queryFn:K,refetchInterval:3e4,placeholderData:e=>e}),H=(0,n.a)({queryKey:["user-growth",V],queryFn:()=>L(V),refetchInterval:3e4,placeholderData:e=>e}),J=(0,n.a)({queryKey:["lead-quality"],queryFn:S,refetchInterval:6e4,placeholderData:e=>e}),X=(0,n.a)({queryKey:["revenue-forecast"],queryFn:E,refetchInterval:6e4,placeholderData:e=>e}),$=(0,n.a)({queryKey:["funnel"],queryFn:R,refetchInterval:6e4,placeholderData:e=>e}),ee=(0,n.a)({queryKey:["top-props"],queryFn:A,refetchInterval:6e4,placeholderData:e=>e}),ea=(0,n.a)({queryKey:["builder-leaderboard"],queryFn:C,refetchInterval:6e4,placeholderData:e=>e}),et=(0,n.a)({queryKey:["recent-activity"],queryFn:U,refetchInterval:3e4,placeholderData:e=>e});return k("page_views",()=>z.invalidateQueries({queryKey:["admin-top"]})),k("leads",()=>{z.invalidateQueries({queryKey:["admin-top"]}),z.invalidateQueries({queryKey:["lead-quality"]}),z.invalidateQueries({queryKey:["top-props"]}),z.invalidateQueries({queryKey:["builder-leaderboard"]}),z.invalidateQueries({queryKey:["recent-activity"]})}),k("events",()=>{z.invalidateQueries({queryKey:["funnel"]}),z.invalidateQueries({queryKey:["recent-activity"]})}),k("payments",()=>{z.invalidateQueries({queryKey:["admin-top"]}),z.invalidateQueries({queryKey:["revenue-forecast"]})}),(0,s.jsxs)("div",{className:"space-y-8",children:[(0,s.jsxs)("div",{className:"flex items-center gap-3",children:[(0,s.jsxs)(c.P,{value:V,onChange:e=>Y(e.target.value),className:"w-[160px] bg-gray-900 text-gray-100 border-gray-800",children:[(0,s.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,s.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,s.jsx)("option",{value:"90d",children:"Last 90 days"})]}),(0,s.jsx)(d.z,{onClick:function(){let e=[];e.push({section:"top",data:G.data}),e.push({section:"user_growth",data:H.data}),e.push({section:"lead_quality",data:J.data}),e.push({section:"revenue_forecast",data:X.data}),e.push({section:"funnel",data:$.data}),e.push({section:"top_properties",data:ee.data}),e.push({section:"builder_leaderboard",data:ea.data}),e.push({section:"activity",data:et.data});let a=new Blob([function(e){let a=[];for(let t of e)if(a.push("SECTION,".concat(t.section)),Array.isArray(t.data))for(let e of t.data)a.push(D(e));else t.data&&"object"==typeof t.data&&a.push(D(t.data));return a.join("\n")}(e)],{type:"text/csv;charset=utf-8;"}),t=document.createElement("a");t.href=URL.createObjectURL(a),t.download="admin-dashboard-".concat((0,x.WU)(new Date,"yyyy-MM-dd-HH-mm"),".csv"),t.click()},className:"bg-gold-600 hover:bg-gold-500 border-gold-500 text-gray-900",children:"Export CSV"}),(0,s.jsx)(d.z,{variant:"secondary",className:"border-gray-800 bg-gray-900 text-gray-200 hover:bg-gray-800",onClick:async()=>{let e=window.prompt("Enter recipient emails (comma separated)")||"";if(!e.trim())return;let a=window.prompt("Frequency: daily, weekly, or monthly","daily")||"daily";try{if(!(await fetch("/api/admin/email-report",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({recipients:e.split(",").map(e=>e.trim()).filter(Boolean),frequency:a,range:V})})).ok)throw Error("Request failed");alert("Report scheduled!")}catch(e){alert("Failed to schedule report")}},children:"Email Report"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4",children:[(0,s.jsx)(I,{title:"Active Users Now",value:null===(e=G.data)||void 0===e?void 0:e.activeUsersNow.value,loading:G.isLoading,accent:"emerald",children:(0,s.jsx)(P,{data:(null===(a=G.data)||void 0===a?void 0:a.activeUsersNow.series)||[],color:"var(--emerald-500)"})}),(0,s.jsx)(I,{title:"Leads Today",value:null===(t=G.data)||void 0===t?void 0:t.leadsToday.value,sub:"".concat(O(null===(o=G.data)||void 0===o?void 0:o.leadsToday.pctVsYesterday)," vs yesterday"),loading:G.isLoading,accent:"gold"}),(0,s.jsx)(I,{title:"Trial Conversions (This Week)",value:null===(u=G.data)||void 0===u?void 0:u.trialConversionsWeek.value,sub:"Rate ".concat(O(null===(_=G.data)||void 0===_?void 0:_.trialConversionsWeek.conversionRate)),loading:G.isLoading,accent:"primary"}),(0,s.jsx)(I,{title:"Revenue (MTD)",value:Z(null===(F=G.data)||void 0===F?void 0:F.revenueMtd.value),sub:"".concat(O(null===(B=G.data)||void 0===B?void 0:B.revenueMtd.growthVsLastMonth)," vs last month"),loading:G.isLoading,accent:"emerald"})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800",children:[(0,s.jsxs)("div",{className:"mb-2 text-gray-200 font-semibold",children:["User Growth (Last ",V.toUpperCase(),")"]}),H.isLoading?(0,s.jsx)("div",{className:"h-64 rounded-md bg-gray-800/60 animate-pulse"}):(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsxs)(h.w,{data:H.data||[],children:[(0,s.jsx)(y.q,{stroke:"#222"}),(0,s.jsx)(p.K,{dataKey:"date",stroke:"#aaa",tick:{fill:"#aaa",fontSize:12}}),(0,s.jsx)(g.B,{stroke:"#aaa",tick:{fill:"#aaa",fontSize:12}}),(0,s.jsx)(v.u,{contentStyle:{background:"#0b0b0b",border:"1px solid #222",color:"#eee"}}),(0,s.jsx)(f.x,{dataKey:"total_users",stroke:"var(--primary-600)",dot:!1,strokeWidth:2,name:"Total Users"}),(0,s.jsx)(f.x,{dataKey:"active_users",stroke:"var(--emerald-500)",dot:!1,strokeWidth:2,name:"Active Users"}),(0,s.jsx)(f.x,{dataKey:"new_users",stroke:"var(--gold-500)",dot:!1,strokeWidth:2,name:"New Signups"})]})})})]}),(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800",children:[(0,s.jsx)("div",{className:"mb-2 text-gray-200 font-semibold",children:"Lead Quality Distribution"}),J.isLoading?(0,s.jsx)("div",{className:"h-64 rounded-md bg-gray-800/60 animate-pulse"}):(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsxs)(b.u,{children:[(0,s.jsx)(j.b,{data:J.data||[],dataKey:"count",nameKey:"category",innerRadius:48,outerRadius:80,paddingAngle:3,children:(J.data||[]).map((e,a)=>(0,s.jsx)(N.b,{fill:T[a%T.length]},a))}),(0,s.jsx)(v.u,{contentStyle:{background:"#0b0b0b",border:"1px solid #222",color:"#eee"}})]})})})]}),(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800 lg:col-span-2",children:[(0,s.jsx)("div",{className:"mb-2 text-gray-200 font-semibold",children:"Revenue Forecast (Next 3 Months)"}),X.isLoading?(0,s.jsx)("div",{className:"h-64 rounded-md bg-gray-800/60 animate-pulse"}):(0,s.jsx)("div",{className:"h-64",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsxs)(w.T,{data:X.data||[],children:[(0,s.jsx)(y.q,{stroke:"#222"}),(0,s.jsx)(p.K,{dataKey:"month",stroke:"#aaa",tick:{fill:"#aaa",fontSize:12}}),(0,s.jsx)(g.B,{stroke:"#aaa",tick:{fill:"#aaa",fontSize:12}}),(0,s.jsx)(v.u,{contentStyle:{background:"#0b0b0b",border:"1px solid #222",color:"#eee"}}),(0,s.jsx)(q.u,{type:"monotone",dataKey:"pessimistic",stroke:"#9ca3af",fill:"#1f2937",name:"Pessimistic"}),(0,s.jsx)(q.u,{type:"monotone",dataKey:"realistic",stroke:"var(--emerald-500)",fill:"rgba(16,185,129,0.15)",name:"Realistic"}),(0,s.jsx)(q.u,{type:"monotone",dataKey:"optimistic",stroke:"var(--gold-500)",fill:"rgba(234,179,8,0.15)",name:"Optimistic"})]})})})]}),(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800 lg:col-span-2",children:[(0,s.jsx)("div",{className:"mb-2 text-gray-200 font-semibold",children:"Acquisition Funnel (Last 30 Days)"}),$.isLoading?(0,s.jsx)("div",{className:"h-64 rounded-md bg-gray-800/60 animate-pulse"}):(0,s.jsx)("div",{className:"h-64 flex items-end gap-4",children:($.data||[]).map(e=>(0,s.jsx)("div",{className:"flex-1",children:(0,s.jsxs)("div",{className:"bg-primary-600/30 border border-primary-600/40 rounded-md p-2 text-center",children:[(0,s.jsx)("div",{className:"text-xs text-gray-400 mb-1",children:e.stage}),(0,s.jsx)("div",{className:"text-h5 font-semibold text-gray-100",children:e.count})]})},e.stage))})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800",children:[(0,s.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,s.jsx)("div",{className:"text-gray-200 font-semibold",children:"Top Performing Properties"})}),(0,s.jsx)("div",{className:"overflow-auto rounded-md border border-gray-800",children:ee.isLoading?(0,s.jsx)("div",{className:"h-48 bg-gray-800/60 animate-pulse"}):(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-800/60 text-gray-300",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Title"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Area"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Views"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Inquiries"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Conv%"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Price"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-800",children:[(ee.data||[]).map((e,a)=>(0,s.jsxs)("tr",{className:"text-gray-200",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.title}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.area||"-"}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.total_views}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.total_inquiries}),(0,s.jsxs)("td",{className:"px-3 py-2 text-right",children:[(100*e.conversion_rate).toFixed(1),"%"]}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.price?Z(e.price):"-"})]},a)),!(null===(M=ee.data)||void 0===M?void 0:M.length)&&!ee.isLoading&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-3 py-4",colSpan:6,children:"No data."})})]})]})})]}),(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800",children:[(0,s.jsx)("div",{className:"mb-3 flex items-center justify-between",children:(0,s.jsx)("div",{className:"text-gray-200 font-semibold",children:"Builder Leaderboard"})}),(0,s.jsx)("div",{className:"overflow-auto rounded-md border border-gray-800",children:ea.isLoading?(0,s.jsx)("div",{className:"h-48 bg-gray-800/60 animate-pulse"}):(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-800/60 text-gray-300",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Name"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Company"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Properties"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Leads"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Closed"}),(0,s.jsx)("th",{className:"px-3 py-2 text-right",children:"Revenue"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-800",children:[(ea.data||[]).map((e,a)=>(0,s.jsxs)("tr",{className:"text-gray-200",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.name}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.company_name||"-"}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.properties_listed}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.total_leads}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.deals_closed}),(0,s.jsx)("td",{className:"px-3 py-2 text-right",children:e.total_revenue?Z(e.total_revenue):"-"})]},a)),!(null===(Q=ea.data)||void 0===Q?void 0:Q.length)&&!ea.isLoading&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-3 py-4",colSpan:6,children:"No data."})})]})]})})]})]}),(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800",children:[(0,s.jsxs)("div",{className:"mb-3 flex items-center justify-between",children:[(0,s.jsx)("div",{className:"text-gray-200 font-semibold",children:"Recent Activity"}),(0,s.jsx)(d.z,{variant:"secondary",className:"border-gray-800 bg-gray-900 text-gray-200 hover:bg-gray-800",onClick:()=>et.refetch(),children:"Refresh"})]}),(0,s.jsx)("div",{className:"overflow-auto rounded-md border border-gray-800",children:et.isLoading?(0,s.jsx)("div",{className:"h-40 bg-gray-800/60 animate-pulse"}):(0,s.jsxs)("table",{className:"min-w-full text-sm",children:[(0,s.jsx)("thead",{className:"bg-gray-800/60 text-gray-300",children:(0,s.jsxs)("tr",{children:[(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Event"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"User"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"Data"}),(0,s.jsx)("th",{className:"px-3 py-2 text-left",children:"When"})]})}),(0,s.jsxs)("tbody",{className:"divide-y divide-gray-800",children:[(et.data||[]).map((e,a)=>(0,s.jsxs)("tr",{className:"text-gray-200",children:[(0,s.jsx)("td",{className:"px-3 py-2",children:e.event_name}),(0,s.jsx)("td",{className:"px-3 py-2",children:e.user_id||"-"}),(0,s.jsx)("td",{className:"px-3 py-2 font-mono text-xs text-gray-400 truncate max-w-[24rem]",children:function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:80;return e.length<=a?e:e.slice(0,a-1)+"…"}(JSON.stringify(e.event_data))}),(0,s.jsx)("td",{className:"px-3 py-2",children:new Date(e.created_at).toLocaleString()})]},a)),!(null===(W=et.data)||void 0===W?void 0:W.length)&&!et.isLoading&&(0,s.jsx)("tr",{children:(0,s.jsx)("td",{className:"px-3 py-4",colSpan:4,children:"No activity yet."})})]})]})})]})]})}function I(e){let{title:a,value:t,sub:i,loading:n,accent:d="primary",children:c}=e,o="number"==typeof t?function(e){let a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:600,[t,s]=(0,r.useState)(e);return(0,r.useEffect)(()=>{let r=0,i=performance.now(),n=e-t;return r=requestAnimationFrame(function e(l){let d=Math.min(1,(l-i)/a);s(Math.round(t+n*(1-Math.pow(1-d,3)))),d<1&&(r=requestAnimationFrame(e))}),()=>cancelAnimationFrame(r)},[e]),t}(t):t;return(0,s.jsxs)(l.Z,{className:"bg-gray-900 border-gray-800",children:[(0,s.jsx)("div",{className:"text-sm text-gray-400",children:a}),(0,s.jsxs)("div",{className:"mt-1 flex items-baseline gap-2",children:[(0,s.jsx)("div",{className:"text-3xl font-semibold text-gray-100 tabular-nums",children:n?"—":null!=o?o:"—"}),i&&(0,s.jsx)("div",{className:"text-xs text-gray-400",children:i})]}),c&&(0,s.jsx)("div",{className:"mt-2",children:c})]})}function P(e){let{data:a,color:t}=e,i=(0,r.useMemo)(()=>(a||[]).map(e=>({t:e.t,v:e.v})),[a]);return(0,s.jsx)("div",{className:"h-12",children:(0,s.jsx)(m.h,{width:"100%",height:"100%",children:(0,s.jsxs)(w.T,{data:i,children:[(0,s.jsx)("defs",{children:(0,s.jsxs)("linearGradient",{id:"grad",x1:"0",y1:"0",x2:"0",y2:"1",children:[(0,s.jsx)("stop",{offset:"5%",stopColor:t,stopOpacity:.6}),(0,s.jsx)("stop",{offset:"95%",stopColor:t,stopOpacity:0})]})}),(0,s.jsx)(q.u,{type:"monotone",dataKey:"v",stroke:t,fill:"url(#grad)",strokeWidth:2})]})})})}let T=["#eab308","#f59e0b","#3b82f6","#6b7280","#d1d5db"];function D(e){return Object.entries(e||{}).map(e=>{var a;let[,t]=e;return(a=String(t)).includes(",")||a.includes("\n")||a.includes('"')?'"'+a.replace(/"/g,'""')+'"':a}).join(",")}function O(e){return null==e||isNaN(e)?"—":"".concat(e>0?"+":"").concat((100*e).toFixed(1),"%")}function Z(e){let a="string"==typeof e?Number(e):e;return null==a||isNaN(a)?"—":new Intl.NumberFormat("en-IN",{style:"currency",currency:"INR",maximumFractionDigits:0}).format(a)}},64308:function(e,a,t){"use strict";t.d(a,{z:function(){return n}});var s=t(57437),r=t(2265),i=t(44839);let n=r.forwardRef(function(e,a){let{className:t,variant:r="primary",size:n="md",...l}=e;return(0,s.jsx)("button",{ref:a,className:(0,i.Z)("inline-flex items-center justify-center rounded-md border font-semibold transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 disabled:opacity-60 disabled:cursor-not-allowed",{primary:"bg-accent text-onEmphasis border-border hover:bg-accentEmphasis focus-visible:ring-[color:var(--color-accent-muted)]",secondary:"bg-canvas text-fg border-border hover:bg-canvasSubtle",invisible:"bg-transparent text-fg border-transparent hover:bg-canvasSubtle",danger:"bg-dangerEmphasis text-onEmphasis border-border hover:brightness-110"}[r],{sm:"text-xs px-2.5 py-1.5",md:"text-sm px-3 py-2"}[n],t),...l})})},57883:function(e,a,t){"use strict";t.d(a,{Z:function(){return i}});var s=t(57437);t(2265);var r=t(44839);function i(e){let{className:a,...t}=e;return(0,s.jsx)("div",{className:(0,r.Z)("rounded-lg border border-border bg-canvas shadow-card p-4",a),...t})}},6807:function(e,a,t){"use strict";t.d(a,{P:function(){return n}});var s=t(57437),r=t(2265),i=t(44839);let n=r.forwardRef(function(e,a){let{className:t,children:r,...n}=e;return(0,s.jsx)("select",{ref:a,className:(0,i.Z)("w-full rounded-md border border-border bg-canvas text-fg px-3 py-2 shadow-sm focus:outline-none focus-visible:ring-2 focus-visible:ring-offset-2 ring-offset-canvas focus-visible:ring-[color:var(--color-accent-muted)]",t),...n,children:r})})}},function(e){e.O(0,[1336,5118,4593,1792,2673,2971,3526,1744],function(){return e(e.s=94388)}),_N_E=e.O()}]);