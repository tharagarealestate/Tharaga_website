(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5229],{93173:function(e,t,i){Promise.resolve().then(i.bind(i,29478))},29478:function(e,t,i){"use strict";i.d(t,{default:function(){return d}});var s=i(57437),a=i(2265),r=i(45447),l=i(84593),n=i(20357);let o=null;function c(){if(!o){let e=n.env.NEXT_PUBLIC_SUPABASE_URL||n.env.SUPABASE_URL,t=n.env.NEXT_PUBLIC_SUPABASE_ANON_KEY||n.env.SUPABASE_ANON_KEY;if(!e||!t)throw Error("Supabase environment variables are not configured");o=(0,l.eI)(e,t)}return o}function d(){let[e,t]=(0,a.useState)(1),[i,l]=(0,a.useState)(!1),[n,o]=(0,a.useState)(null),[d,m]=(0,a.useState)("starter"),[u,h]=(0,a.useState)(1),[x,p]=(0,a.useState)({title:"",description:"",city:"",locality:"",property_type:"Apartment",bedrooms:"",bathrooms:"",price_inr:"",sqft:"",images:[]});async function g(){let{data:{session:e}}=await c().auth.getSession();if(e)return e;let t=prompt("Enter your email to continue:");if(!t)throw Error("Email required");let{error:i}=await c().auth.signInWithOtp({email:t});if(i)throw i;throw alert("Check your email for a login link, then return to this page."),Error("Pending login")}async function f(e){let t=e.target.files;if(t&&t.length){l(!0),o("Uploading images…");try{let{data:{user:e}}=await c().auth.getUser();if(!e)throw Error("Login required");let i=[];for(let s of Array.from(t)){let t="".concat(e.id,"/").concat(Date.now(),"_").concat(s.name),{data:a,error:r}=await c().storage.from("property-images").upload(t,s);if(r)throw r;let{data:l}=c().storage.from("property-images").getPublicUrl(a.path);i.push(l.publicUrl)}p(e=>({...e,images:[...e.images,...i]})),o("Images uploaded ✔")}catch(e){o((null==e?void 0:e.message)||"Upload failed")}finally{l(!1)}}}async function b(e){e.preventDefault(),l(!0),o("Saving…");try{let e=(await g()).user.id,i={title:x.title.trim(),description:x.description.trim(),city:x.city.trim(),locality:x.locality.trim()||null,property_type:x.property_type,bedrooms:Number(x.bedrooms)||null,bathrooms:Number(x.bathrooms)||null,price_inr:Number(x.price_inr)||0,sqft:Number(x.sqft)||null,images:x.images,builder_id:e,listing_status:"active"};if(Number.isFinite(u)){let{count:t}=await c().from("properties").select("id",{count:"exact",head:!0}).eq("builder_id",e).eq("listing_status","active");if((t||0)>=u){o("Your plan (".concat(d,") allows ").concat(u," active project").concat(1===u?"":"s",". Upgrade on Pricing."));return}}let{error:s}=await c().from("properties").insert([i]);if(s)throw s;o("Submitted! Pending verification."),t(3)}catch(e){o((null==e?void 0:e.message)||"Save failed")}finally{l(!1)}}return async function(){try{var e;let{data:{session:t}}=await c().auth.getSession();if(!(null==t?void 0:null===(e=t.user)||void 0===e?void 0:e.email))return;let{data:i}=await c().from("org_subscriptions").select("tier,status").eq("email",t.user.email).maybeSingle(),s=(null==i?void 0:i.tier)||"starter";m(s),h("scale"===s?Number.POSITIVE_INFINITY:"growth"===s?5:1)}catch(e){}}(),(0,s.jsxs)("main",{className:"mx-auto max-w-3xl px-6 py-8",children:[(0,s.jsx)("h1",{className:"text-2xl font-bold text-fg mb-2",children:"List your property"}),(0,s.jsx)("p",{className:"text-fgMuted mb-2",children:"Simple onboarding for builders. Logged in users can save drafts and submit for verification."}),(0,s.jsxs)("div",{className:"mb-6 text-sm text-fgMuted",children:["Your plan: ",(0,s.jsx)("b",{className:"text-fg",children:d}),". Active project limit: ",Number.isFinite(u)?u:"Unlimited"," • ",(0,s.jsx)("a",{className:"underline",href:"/pricing/",children:"See pricing"})]}),n&&(0,s.jsx)(r.Zb,{className:"mb-4 text-sm",children:(0,s.jsx)("div",{children:n})}),1===e&&(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault(),t(2)},className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Title"}),(0,s.jsx)(r.II,{required:!0,value:x.title,onChange:e=>p({...x,title:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Description"}),(0,s.jsx)(r.Kx,{required:!0,rows:4,value:x.description,onChange:e=>p({...x,description:e.target.value})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"City"}),(0,s.jsx)(r.II,{required:!0,value:x.city,onChange:e=>p({...x,city:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Locality"}),(0,s.jsx)(r.II,{value:x.locality,onChange:e=>p({...x,locality:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-3 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Type"}),(0,s.jsxs)(r.Ph,{value:x.property_type,onChange:e=>p({...x,property_type:e.target.value}),children:[(0,s.jsx)("option",{children:"Apartment"}),(0,s.jsx)("option",{children:"Villa"}),(0,s.jsx)("option",{children:"Plot"}),(0,s.jsx)("option",{children:"Commercial"})]})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Bedrooms"}),(0,s.jsx)(r.II,{value:x.bedrooms,onChange:e=>p({...x,bedrooms:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Bathrooms"}),(0,s.jsx)(r.II,{value:x.bathrooms,onChange:e=>p({...x,bathrooms:e.target.value})})]})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Price (₹)"}),(0,s.jsx)(r.II,{required:!0,value:x.price_inr,onChange:e=>p({...x,price_inr:e.target.value})})]}),(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Area (sqft)"}),(0,s.jsx)(r.II,{value:x.sqft,onChange:e=>p({...x,sqft:e.target.value})})]})]}),(0,s.jsx)("div",{className:"flex justify-end",children:(0,s.jsx)(r.zx,{children:"Next"})})]}),2===e&&(0,s.jsxs)("form",{onSubmit:b,className:"space-y-4",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("label",{className:"block text-sm font-medium",children:"Upload images"}),(0,s.jsx)("input",{type:"file",accept:"image/*",multiple:!0,onChange:f}),x.images.length>0&&(0,s.jsx)("div",{className:"mt-2 grid grid-cols-3 gap-2",children:x.images.map((e,t)=>(0,s.jsx)("img",{src:e,alt:"",className:"h-24 w-full object-cover rounded"},t))})]}),(0,s.jsxs)("div",{className:"flex items-center justify-between",children:[(0,s.jsx)(r.zx,{type:"button",variant:"secondary",onClick:()=>t(1),children:"Back"}),(0,s.jsx)(r.zx,{disabled:i,children:"Submit"})]})]}),3===e&&(0,s.jsxs)(r.Zb,{children:[(0,s.jsx)("div",{className:"font-semibold text-fg",children:"Thanks! Your property is submitted."}),(0,s.jsx)("div",{className:"text-fgMuted text-sm",children:"We’ll verify details and make it visible to buyers shortly."})]})]})}}},function(e){e.O(0,[8869,4593,5447,2971,3526,1744],function(){return e(e.s=93173)}),_N_E=e.O()}]);