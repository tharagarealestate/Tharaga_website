<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Tharaga — Home</title>
  <script type="module" src="/js/fragment-handle.js"></script>
  <script src="/js/auth-modal-stub.js" defer></script>
  <style>
    :root { --brand:#6e0d25; --brand-600:#8a1637; --surface:#0f0d0e; --surface-2:#151316; --text:#fff; --muted:#c6c3c6; --ring:rgba(212,175,55,.35); --ok:#39b54a; }
    body { font-family: Inter, ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial; margin:0; padding:0; background:#fafafa; color:#222; display:flex; align-items:center; justify-content:center; min-height:100vh; text-align:center; flex-direction:column; }
    h1 { font-size: 2rem; margin-bottom: 1rem; }
    p  { max-width: 600px; margin-bottom: 2rem; }
    nav a { margin:0 1rem; text-decoration:none; font-weight:500; color:#0055ff; }
    nav a:hover { text-decoration: underline; }
    footer { margin-top: 2rem; font-size: 0.9rem; color: #666; }

    .cta { position:relative; margin-top:2rem; background: radial-gradient(1200px 200px at 20% -50%, rgba(110,13,37,0.45), transparent), linear-gradient(180deg, var(--surface-2), var(--surface)); color:var(--text); padding:18px 22px; border-radius:16px; width:min(720px,92vw); box-shadow:0 10px 28px rgba(0,0,0,0.22); text-align:left; border:1px solid rgba(255,255,255,0.06); }
    .cta::after{ content:""; position:absolute; inset:0; border-radius:16px; pointer-events:none; box-shadow:0 0 0 1px var(--ring) inset; opacity:.35; }
    .cta h2 { margin: 0 0 6px; font-size: 1.25rem; letter-spacing: .2px; }
    .cta p { margin: 0 0 12px; color: #e7e2e5; font-size: .95rem; }
    .cta .row { display:grid; grid-template-columns:1fr auto; gap:12px; align-items:center; }
    .field-inline input { width:100%; min-width:200px; padding:12px 14px; border-radius:12px; border:1px solid rgba(255,255,255,0.08); background:rgba(255,255,255,0.06); color:var(--text); outline:none; }
    .field-inline input::placeholder{ color:rgba(255,255,255,0.6) }
    .primary-btn{ padding:12px 18px; border-radius:12px; border:0; background:var(--brand); color:#fff; font-weight:700; cursor:pointer; box-shadow:0 6px 18px rgba(110,13,37,0.35) }
    .primary-btn:hover{ background:var(--brand-600) }
    .note{ font-size:.82rem; color:#e7e2e5; margin-top:10px; opacity:.85 }

    .modal-backdrop{ position:fixed; inset:0; background:rgba(9,7,8,.58); display:none; align-items:center; justify-content:center; padding:22px; backdrop-filter:blur(4px) }
    .modal{ width:min(560px,96vw); background:linear-gradient(180deg,#141115,#0f0d0e); color:var(--text); border-radius:16px; padding:18px; box-shadow:0 24px 50px rgba(0,0,0,.45); border:1px solid rgba(255,255,255,.06) }
    .modal h3{ margin:0 0 12px; font-size:1.1rem }
    .modal .grid{ display:grid; grid-template-columns:1fr 1fr; gap:12px }
    @media (max-width:560px){ .modal .grid{ grid-template-columns:1fr } }
    .modal label{ font-size:.86rem; color:#e4dfe3; display:inline-block; margin-bottom:6px }
    .modal input,.modal textarea{ width:100%; padding:11px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.08); background:rgba(255,255,255,.06); color:var(--text); outline:none }
    .modal input:focus,.modal textarea:focus{ box-shadow:0 0 0 2px var(--ring); border-color:transparent }
    .modal textarea{ min-height:96px; resize:vertical }
    .modal .actions{ display:flex; gap:10px; justify-content:flex-end; margin-top:14px }
    .modal .btn{ padding:10px 14px; border-radius:12px; border:0; cursor:pointer; font-weight:600 }
    .btn-secondary{ background:rgba(255,255,255,.08); color:#fff }
    .btn-secondary:hover{ background:rgba(255,255,255,.12) }
    .btn-primary{ background:var(--brand); color:#fff }
    .btn-primary:hover{ background:var(--brand-600) }
    .error{ color:#ff6b6b }
    .ok{ color:var(--ok) }
    .visually-hidden{ position:absolute; width:1px; height:1px; padding:0; margin:-1px; overflow:hidden; clip:rect(0,0,0,0); border:0 }
  </style>
  
</head>
<body>
  <h1>Welcome to Tharaga</h1>
  <p>
    This is the unified website. Use the links below or Durable can embed
    each section directly using its own route.
  </p>
  <nav>
    <a href="/about/">About</a>
    <a href="/buyer-form/">Buyer Form</a>
    <a href="/property-listing/">Properties</a>
    <a href="/rating/">Rating</a>
    <a href="/reel-grid/">Reels</a>
    <a href="/registration/">Registration</a>
    <a href="/search-filter-home/">Search Filter</a>
    <a href="/Reset_password/">Reset password</a>
    <a href="auth-landing/">auth landing</a>
    <a href="auth-email-landing/">auth email landing</a>
    <a href="snippets/">login/signup</a>
    <a href="/app/">AI Recommendations (Next.js)</a>
  </nav>

  <section class="cta" id="buyer-cta">
    <h2>Get 3 verified matches</h2>
    <p>Share your WhatsApp or phone. Our team sends hand‑picked options fast.</p>
    <div class="row">
      <div class="field-inline">
        <label for="cta-phone" class="visually-hidden">WhatsApp or phone</label>
        <input id="cta-phone" type="tel" placeholder="WhatsApp / phone" inputmode="tel" autocomplete="tel" />
      </div>
      <button id="open-microform" class="primary-btn" type="button" aria-haspopup="dialog" aria-controls="backdrop">Continue</button>
    </div>
    <div class="note">Low effort, high signal: no spam, only verified listings.</div>
  </section>
  <footer>© <span id="year"></span> Tharaga</footer>
  <script>
  // Auth header is loaded via external script for reuse across pages
  </script>
  
  <script>
    document.getElementById("year").textContent = new Date().getFullYear();
  </script>
  <script>
    const backdrop = document.createElement('div');
    backdrop.className = 'modal-backdrop';
    backdrop.id = 'backdrop';
    backdrop.innerHTML = `
      <div class="modal" role="dialog" aria-modal="true" aria-labelledby="lead-title" aria-describedby="lead-note">
        <h3 id="lead-title">Tell us what you need</h3>
        <div class="grid">
          <div>
            <label for="lead-name">Name</label>
            <input id="lead-name" type="text" placeholder="Your name" />
          </div>
          <div>
            <label for="lead-phone">WhatsApp / phone</label>
            <input id="lead-phone" type="tel" placeholder="Required" inputmode="tel" autocomplete="tel" />
          </div>
          <div>
            <label for="lead-email">Email (optional)</label>
            <input id="lead-email" type="email" placeholder="you@example.com" autocomplete="email" />
          </div>
          <div>
            <label for="lead-ctx">City / Budget (optional)</label>
            <input id="lead-ctx" type="text" placeholder="e.g., Chennai · 70L" />
          </div>
          <div style="grid-column: 1 / -1;">
            <label for="lead-message">Anything specific?</label>
            <textarea id="lead-message" placeholder="Locality, BHK, timeline…"></textarea>
          </div>
        </div>
        <div class="actions">
          <button class="btn btn-secondary" id="lead-cancel" type="button">Cancel</button>
          <button class="btn btn-primary" id="lead-submit" type="button">Request matches</button>
        </div>
        <div class="note" id="lead-note" aria-live="polite"></div>
      </div>`;
    document.body.appendChild(backdrop);

    const openBtn = document.getElementById('open-microform');
    const phoneInline = document.getElementById('cta-phone');
    const modal = backdrop.querySelector('.modal');
    const cancelBtn = backdrop.querySelector('#lead-cancel');

    let lastFocused = null;
    function getFocusable(){ return modal.querySelectorAll('a, button, input, textarea, select, [tabindex]:not([tabindex="-1"])'); }
    function openModal(){
      const phoneVal = (phoneInline?.value || '').trim();
      const phoneInput = backdrop.querySelector('#lead-phone');
      if (phoneVal && phoneInput && !phoneInput.value) phoneInput.value = phoneVal;
      lastFocused = document.activeElement;
      backdrop.style.display = 'flex';
      backdrop.setAttribute('aria-hidden','false');
      const f = getFocusable(); if (f.length) f[0].focus();
    }
    function closeModal(){
      backdrop.style.display = 'none';
      backdrop.setAttribute('aria-hidden','true');
      document.getElementById('lead-note').textContent = '';
      if (lastFocused && lastFocused.focus) setTimeout(()=> lastFocused.focus(), 0);
    }

    openBtn?.addEventListener('click', openModal);
    cancelBtn?.addEventListener('click', closeModal);
    backdrop.addEventListener('click', (e)=>{ if (e.target === backdrop) closeModal(); });
    modal.addEventListener('keydown', (e)=>{
      if (e.key === 'Escape'){ e.preventDefault(); closeModal(); return; }
      if (e.key === 'Tab'){
        const focusable = Array.from(getFocusable());
        const first = focusable[0]; const last = focusable[focusable.length-1];
        if (e.shiftKey && document.activeElement === first){ e.preventDefault(); last.focus(); }
        if (!e.shiftKey && document.activeElement === last){ e.preventDefault(); first.focus(); }
      }
    });

    const ALLOWED_PARENTS = ['https://tharaga.co.in','https://www.tharaga.co.in','https://auth.tharaga.co.in', location.origin];
    function postToParent(payload){
      try {
        const parentOrigin = (function(){ try { return new URL(document.referrer).origin; } catch(_) { return '*'; } })();
        if (ALLOWED_PARENTS.includes(parentOrigin) || /tharaga\.co\.in/.test(parentOrigin)) window.parent.postMessage(payload, parentOrigin);
        else window.parent.postMessage(payload, '*');
      } catch(_){ }
    }

    async function submitLead(){
      const name = (document.getElementById('lead-name').value || '').trim();
      const phone = (document.getElementById('lead-phone').value || '').trim();
      const email = (document.getElementById('lead-email').value || '').trim();
      const ctx = (document.getElementById('lead-ctx').value || '').trim();
      const message = (document.getElementById('lead-message').value || '').trim();
      const note = document.getElementById('lead-note'); note.textContent = '';
      if (!phone && !email){ note.textContent = 'Provide WhatsApp/phone or email.'; note.className='note error'; document.getElementById('lead-phone').focus(); return; }
      if (email && !/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(email)){ note.textContent='Enter a valid email.'; note.className='note error'; document.getElementById('lead-email').focus(); return; }
      const btn = document.getElementById('lead-submit'); btn.disabled = true; btn.textContent = 'Sending…';
      try {
        const payload = { property_id:null, name, phone, email, message:[ctx, message].filter(Boolean).join(' • ') };
        const res = await fetch('/api/leads', { method:'POST', headers:{ 'Content-Type':'application/json' }, body: JSON.stringify(payload) });
        const data = await res.json();
        if (data && data.ok){ note.textContent='Thanks! We will WhatsApp you verified matches soon.'; note.className='note ok'; postToParent({ type:'tharaga_lead_ok', payload }); setTimeout(closeModal, 900); }
        else { note.textContent = (data && data.error) || 'Could not submit right now. Please try again.'; note.className='note error'; postToParent({ type:'tharaga_lead_error', error: (data && data.error) || 'unknown' }); }
      } catch(_) { note.textContent='Network issue. Please try again.'; note.className='note error'; postToParent({ type:'tharaga_lead_error', error:'network' }); }
      finally { btn.disabled=false; btn.textContent='Request matches'; }
    }
    document.getElementById('lead-submit')?.addEventListener('click', submitLead);
    modal.addEventListener('keydown', (e)=>{ if (e.key==='Enter' && (e.target.tagName==='INPUT')) { e.preventDefault(); submitLead(); }});
  </script>
  <script>
    try {
      const params = new URLSearchParams(location.search);
      const inlinePhone = params.get('phone') || params.get('whatsapp') || '';
      if (inlinePhone) { const el = document.getElementById('cta-phone'); if (el) el.value = inlinePhone; }
      if (params.get('embed') === 'cta') {
        document.querySelectorAll('h1, nav, p, footer').forEach(el => el.style.display = 'none');
        const cta = document.getElementById('buyer-cta');
        if (cta) { cta.style.marginTop = '0'; }
      }
      if (params.get('open') === '1') { const btn = document.getElementById('open-microform'); btn && btn.click(); }
    } catch (e) {}
  </script>
</body>
</html>
