<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Direct-to-Builder Deals</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            fgMuted: 'rgb(107, 114, 128)',
            border: 'rgb(229, 231, 235)',
            muted: 'rgb(243, 244, 246)',
          }
        }
      }
    }
  </script>
  <style>
    .visually-hidden {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0, 0, 0, 0);
      white-space: nowrap;
      border-width: 0;
    }
  </style>
</head>
<body class="bg-white">
  <main class="mx-auto max-w-5xl px-6 py-8">
    <div class="flex items-center justify-between mb-6">
      <div>
        <h1 class="text-2xl font-bold mb-2">Direct-to-Builder Deals</h1>
        <p class="text-sm text-fgMuted">Manage pricing, discounts, and instant buyer chat with audit trail.</p>
      </div>
      <div class="flex items-center gap-3">
        <button id="startFree" class="px-4 py-2 bg-yellow-400 text-gray-900 font-semibold rounded border border-yellow-400 hover:bg-yellow-500 transition-colors">Start free</button>
        <a href="/" class="text-sm text-fgMuted hover:text-gray-900 underline">← Back</a>
      </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-6">
      <aside class="lg:col-span-1 border border-border rounded p-4 bg-white">
        <h2 class="text-lg font-semibold mb-4">Deal Controls</h2>
        <div class="space-y-4">
          <div>
            <label for="base" class="block text-sm font-medium mb-2">Base Price (₹/sqft)</label>
            <input id="base" class="w-full px-3 py-2 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" type="number" value="7200" />
          </div>
          <div>
            <label for="disc" class="block text-sm font-medium mb-2">Discount (%)</label>
            <input id="disc" class="w-full px-3 py-2 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" type="number" value="5" />
          </div>
          <div>
            <label for="exp" class="block text-sm font-medium mb-2">Offer Expires</label>
            <input id="exp" class="w-full px-3 py-2 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" type="date" />
          </div>
          <div>
            <label for="pay" class="block text-sm font-medium mb-2">Payment Schedule</label>
            <select id="pay" class="w-full px-3 py-2 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500">
              <option>Construction Linked</option>
              <option>20-80 Plan</option>
              <option>10-90 Plan</option>
            </select>
          </div>
          <button id="apply" class="w-full px-4 py-2 bg-blue-600 text-white font-semibold rounded hover:bg-blue-700 transition-colors">Apply Offer</button>
        </div>
      </aside>

      <main class="lg:col-span-2 space-y-6">
        <div class="border border-border rounded overflow-hidden">
          <div class="bg-muted/40 px-3 py-2 border-b border-border">
            <h2 class="text-lg font-semibold">Live Quotes</h2>
          </div>
          <div class="overflow-auto">
            <table class="min-w-[720px] w-full text-sm">
              <thead>
                <tr class="bg-muted/40">
                  <th class="text-left p-3">Buyer</th>
                  <th class="text-left p-3">Area (sqft)</th>
                  <th class="text-left p-3">Quote (₹)</th>
                  <th class="text-left p-3">Status</th>
                </tr>
              </thead>
              <tbody id="quotes">
              </tbody>
            </table>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <section class="md:col-span-2 border border-border rounded p-4 bg-white">
            <h3 class="text-base font-semibold mb-3">Chat</h3>
            <div id="chat" class="h-40 border border-border rounded p-3 overflow-auto bg-gray-50 mb-3 text-sm"></div>
            <div class="flex gap-2">
              <input id="msg" class="flex-1 px-3 py-2 text-sm border border-border rounded focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-blue-500" placeholder="Type message" />
              <button id="send" class="px-4 py-2 bg-blue-600 text-white font-semibold rounded text-sm hover:bg-blue-700 transition-colors">Send</button>
            </div>
          </section>
          <section class="border border-border rounded p-4 bg-white">
            <h3 class="text-base font-semibold mb-3">Offer Summary</h3>
            <div id="sum" class="text-sm space-y-2"></div>
          </section>
        </div>
      </main>
    </div>
  </main>

  <script>
    (function(){
      function openLogin(next){
        try { if (window.parent && window.parent.authGate && typeof window.parent.authGate.openLoginModal === 'function'){ window.parent.authGate.openLoginModal({ next: next || (location.pathname + location.search) }); return; } } catch(_){ }
        try { window.parent && window.parent.postMessage({ type:'open_login_modal', next: next || (location.pathname + location.search) }, '*'); } catch(_){ }
        try { if (typeof window.__thgOpenAuthModal === 'function') window.__thgOpenAuthModal({ next: next || (location.pathname + location.search) }); } catch(_){ }
      }
      try { document.getElementById('startFree').addEventListener('click', function(){ openLogin(); }); } catch(_){ }

      // auto-resize when embedded
      function notifyHeight(){
        try { const h = document.documentElement.scrollHeight; window.parent && window.parent.postMessage({ type:'thg-embed-height', id:'builder-deals', height:h }, '*'); } catch(_){ }
      }
      try { new ResizeObserver(notifyHeight).observe(document.body); } catch(_){ }
      setInterval(notifyHeight, 1000);
      notifyHeight();
      const rupee = (n)=> '₹' + n.toLocaleString('en-IN');
      const base = document.getElementById('base');
      const disc = document.getElementById('disc');
      const exp = document.getElementById('exp');
      const pay = document.getElementById('pay');
      const sum = document.getElementById('sum');

      const quotesEl = document.getElementById('quotes');
      const chat = document.getElementById('chat');
      const msg = document.getElementById('msg');
      const send = document.getElementById('send');

      const buyers = [
        { name: 'Arun', sqft: 980 },
        { name: 'Divya', sqft: 1240 },
        { name: 'Kumar', sqft: 765 },
      ];

      function compute(){
        const bp = Number(base.value || 0);
        const d = Math.min(50, Math.max(0, Number(disc.value || 0)));
        const multiplier = (100 - d)/100;
        sum.innerHTML = [
          '<div><strong>Base:</strong> ', rupee(bp), ' /sqft</div>',
          '<div><strong>Discount:</strong> ', d, '%</div>',
          '<div><strong>Net:</strong> ', rupee(Math.round(bp*multiplier)), ' /sqft</div>',
          '<div><strong>Plan:</strong> ', pay.value, '</div>',
          '<div><strong>Expires:</strong> ', (exp.value||'—'), '</div>'
        ].join('');

        quotesEl.innerHTML = buyers.map(b => {
          const quote = Math.round(bp*multiplier*b.sqft);
          return '<tr class="border-t border-border"><td class="p-3 font-medium">' + b.name + '</td><td class="p-3">' + b.sqft + '</td><td class="p-3">' + rupee(quote) + '</td><td class="p-3"><span class="px-2 py-1 text-xs bg-blue-100 text-blue-800 rounded-full">New</span></td></tr>';
        }).join('');
      }

      function chatLine(who, text){
        const el = document.createElement('div');
        el.className = 'mb-2';
        el.innerHTML = '<strong>' + who + ':</strong> ' + text;
        chat.appendChild(el);
        chat.scrollTop = chat.scrollHeight;
      }

      base.addEventListener('input', compute);
      disc.addEventListener('input', compute);
      exp.addEventListener('input', compute);
      pay.addEventListener('change', compute);
      apply.addEventListener('click', compute);
      compute();

      send.addEventListener('click', () => {
        const text = (msg.value||'').trim();
        if (!text) return;
        chatLine('Builder', text);
        msg.value = '';
        setTimeout(() => chatLine('Arun', 'Thanks, checking with family.'), 500);
      });
    })();
  </script>
</body>
</html>
