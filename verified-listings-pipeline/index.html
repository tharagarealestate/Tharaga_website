<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Verified Listings Pipeline</title>
  <link rel="stylesheet" href="/css/brand.css" />
  <style>
    body{ padding:24px; }
    header{ display:flex; align-items:center; justify-content:space-between; margin-bottom:16px; }
    h1.h1{ margin:0 0 6px; }
    .docs{ display:flex; flex-wrap:wrap; gap:8px; margin:8px 0 0; }
    .chip{ display:inline-flex; align-items:center; gap:6px; padding:6px 10px; border-radius:9999px; border:1px solid #e5e7eb; background:#fff }
    .chip input{ accent-color: var(--brand); }
    ul.steps{ list-style:none; padding:0; margin:0; }
    ul.steps li{ display:flex; align-items:center; gap:8px; padding:8px 0; border-bottom:1px dashed #eee; }
    .st{ width:9px; height:9px; border-radius:50%; background:#ddd }
    .st.ok{ background:#22c55e }
    .st.run{ background:#f59e0b; animation:pulse .8s infinite alternate }
    @keyframes pulse { to{ transform: scale(1.15) } }
    pre{ background:#0b0b0b; color:#fff; padding:12px; border-radius:12px; overflow:auto }
  </style>
</head>
<body>
  <header>
    <div>
      <h1 class="h1">Verified Listings Pipeline</h1>
      <p class="sub">Upload docs, run automated checks, and publish with a verified badge buyers trust.</p>
    </div>
    <div style="display:flex;align-items:center;gap:10px">
      <button id="startFree" class="btn" style="background:#facc15;color:#111;border-color:#facc15">Start free</button>
      <a href="/" style="color:#111;text-decoration:none">← Back</a>
    </div>
  </header>

  <section class="card container" style="padding:16px" aria-labelledby="docs-title">
    <h2 id="docs-title" style="margin:0 0 8px">1) Documents</h2>
    <small>Select the documents you have ready</small>
    <div class="docs" role="group" aria-label="Documents">
      <label class="chip"><input type="checkbox" value="sale_deed" checked> Sale Deed</label>
      <label class="chip"><input type="checkbox" value="ec"> Encumbrance Certificate</label>
      <label class="chip"><input type="checkbox" value="patta"> Patta/Chitta</label>
      <label class="chip"><input type="checkbox" value="kyc"> Owner KYC (Aadhaar)</label>
      <label class="chip"><input type="checkbox" value="tax"> Tax Receipts</label>
    </div>
    <div style="margin-top:12px;display:flex;gap:8px">
      <button id="simulateUpload" class="btn">Simulate upload</button>
      <button id="runBtn" class="btn" disabled>Run verification</button>
    </div>
  </section>

  <section class="card" aria-labelledby="checks-title">
    <h2 id="checks-title" style="margin:0 0 8px">2) Automated & manual checks</h2>
    <ul id="steps" class="steps" aria-live="polite">
      <li data-step="complete"><span class="st"></span> Document completeness</li>
      <li data-step="ocr"><span class="st"></span> OCR & validations</li>
      <li data-step="registry"><span class="st"></span> Registration & EC checks</li>
      <li data-step="fraud"><span class="st"></span> Fraud risk scoring</li>
      <li data-step="review"><span class="st"></span> Human review</li>
    </ul>
  </section>

  <section class="card" aria-labelledby="badge-title">
    <h2 id="badge-title" style="margin:0 0 8px">3) Badge & summary</h2>
    <div id="badge" class="badge" aria-live="polite">Verification pending</div>
    <div style="margin-top:12px">
      <pre id="summary" aria-live="polite">{ "status": "pending" }</pre>
    </div>
  </section>

  <script>
    (function(){
      function openLogin(next){
        try { if (window.parent && window.parent.authGate && typeof window.parent.authGate.openLoginModal === 'function'){ window.parent.authGate.openLoginModal({ next: next || (location.pathname + location.search) }); return; } } catch(_){ }
        try { window.parent && window.parent.postMessage({ type:'open_login_modal', next: next || (location.pathname + location.search) }, '*'); } catch(_){ }
        try { if (typeof window.__thgOpenAuthModal === 'function') window.__thgOpenAuthModal({ next: next || (location.pathname + location.search) }); } catch(_){ }
      }
      try { document.getElementById('startFree').addEventListener('click', function(){ openLogin(); }); } catch(_){ }

      // Auto-resize when embedded via iframe
      function notifyHeight(){
        try { const h = document.documentElement.scrollHeight; window.parent && window.parent.postMessage({ type:'thg-embed-height', id:'verified-listings-pipeline', height:h }, '*'); } catch(_){ }
      }
      try { new ResizeObserver(notifyHeight).observe(document.body); } catch(_){ }
      setInterval(notifyHeight, 1000);
      notifyHeight();

      const uploadBtn = document.getElementById('simulateUpload');
      const runBtn = document.getElementById('runBtn');
      const badge = document.getElementById('badge');
      const steps = Array.from(document.querySelectorAll('#steps li'));
      const summary = document.getElementById('summary');

      let uploaded = false;

      uploadBtn.addEventListener('click', () => {
        uploaded = true;
        runBtn.disabled = false;
        uploadBtn.textContent = 'Docs uploaded';
      });

      function setStep(stepKey, cls){
        const li = steps.find(li => li.getAttribute('data-step') === stepKey);
        if (!li) return;
        const dot = li.querySelector('.st');
        dot.className = 'st ' + cls;
      }

      function run(){
        const startedAt = Date.now();
        const seq = [
          ['complete','run', 400],
          ['complete','ok', 120],
          ['ocr','run', 200],
          ['ocr','ok', 100],
          ['registry','run', 220],
          ['registry','ok', 110],
          ['fraud','run', 200],
          ['fraud','ok', 120],
          ['review','run', 200],
          ['review','ok', 120],
        ];
        let i = 0;
        function step(){
          if (i >= seq.length){
            const ms = Date.now() - startedAt;
            badge.className = 'badge ok';
            badge.textContent = 'Verified • SLA: 48h (simulated ' + ms + 'ms)';
            const json = {
              status: 'verified',
              checks: steps.map(li => ({ key: li.getAttribute('data-step'), status: li.querySelector('.st').classList.contains('ok') ? 'ok' : 'pending' })),
              verifiedAt: new Date().toISOString(),
              badge: 'verified'
            };
            summary.textContent = JSON.stringify(json, null, 2);
            return;
          }
          const [key, cls, wait] = seq[i++];
          setStep(key, cls);
          setTimeout(step, wait);
        }
        step();
      }

      runBtn.addEventListener('click', () => {
        if (!uploaded) return;
        runBtn.disabled = true;
        run();
      });
    })();
  </script>
</body>
</html>
